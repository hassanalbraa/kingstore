
{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user within the KING STORE application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "username": {
          "type": "string",
          "description": "The user's username."
        },
        "balance": {
          "type": "number",
          "description": "The user's current balance."
        },
        "isAdmin": {
          "type": "boolean",
          "description": "Indicates whether the user has administrator privileges."
        }
      },
      "required": [
        "id",
        "username",
        "balance",
        "isAdmin"
      ]
    },
    "GameOffer": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "GameOffer",
      "type": "object",
      "description": "Represents a game offer available to users.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the GameOffer entity."
        },
        "gameName": {
          "type": "string",
          "description": "The name of the game (e.g., PUBG, Free Fire)."
        },
        "offerName": {
          "type": "string",
          "description": "The name of the specific offer (e.g., 60 Ø´Ø¯Ø©, Ø¹Ø¶ÙˆÙŠØ© Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©)."
        },
        "price": {
          "type": "number",
          "description": "The price of the game offer."
        },
        "unit": {
          "type": "string",
          "description": "The unit of the offer (e.g., Ø´Ø¯Ø©, ðŸ’Ž, ðŸª™)."
        }
      },
      "required": [
        "id",
        "gameName",
        "offerName",
        "price"
      ]
    },
    "UserGameOffer": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserGameOffer",
      "type": "object",
      "description": "Represents a user's purchase of a game offer.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the UserGameOffer entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User."
        },
        "gameOfferId": {
          "type": "string",
          "description": "Reference to GameOffer."
        },
        "gameName": {
          "type": "string"
        },
        "offerName": {
          "type": "string"
        },
        "price": {
          "type": "number"
        },
        "status": {
          "type": "string",
          "enum": ["pending", "completed", "failed"]
        },
        "createdAt": {
            "type": "string",
            "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "gameOfferId",
        "gameName",
        "offerName",
        "price",
        "status",
        "createdAt"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles. The 'userId' parameter is the unique identifier for each user.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "gameOffers/{gameOfferId}",
        "definition": {
          "entityName": "GameOffer",
          "schema": {
            "$ref": "#/backend/entities/GameOffer"
          },
          "description": "Stores information about available game offers.  The 'gameOfferId' parameter is the unique identifier for each game offer.",
          "params": [
            {
              "name": "gameOfferId",
              "description": "The unique identifier of the game offer."
            }
          ]
        }
      },
      {
        "path": "users/{userId}/userGameOffers/{userGameOfferId}",
        "definition": {
          "entityName": "UserGameOffer",
          "schema": {
            "$ref": "#/backend/entities/UserGameOffer"
          },
          "description": "Stores the relationship between users and game offers.  Path based ownership is used. The 'userId' parameter represents the user who owns the relationship, and 'userGameOfferId' uniquely identifies the specific relationship.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "userGameOfferId",
              "description": "The unique identifier of the user game offer."
            }
          ]
        }
      },
      {
        "path": "roles_admin/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Collection to store user IDs with admin roles. Existence of document implies user has admin privileges.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support the KING STORE application's features, focusing on user authentication, game offer management, and admin functionalities. The structure prioritizes authorization independence, clarity, and scalability. It avoids hierarchical authorization dependencies by denormalizing necessary authorization data. Structural segregation ensures that collections have a homogeneous security posture, simplifying security rules.  \n\nThe `users` collection stores user profiles.  Admin privileges are managed via a separate `roles_admin` collection, ensuring that checking for admin status relies on document existence, and not on mutable data within the user document itself.  This provides a more robust and reliable authorization mechanism. The `gameOffers` collection stores information about available game offers.  The `users/{userId}/userGameOffers` collection stores relationships between users and the game offers they have purchased. This structure enable path-based ownership, making security rules simple and efficient.\n\nThis structure achieves authorization independence by avoiding `get()` calls in security rules. For example, checking if a user is an admin is done by checking for the existence of a document in the `roles_admin/{userId}` collection, rather than reading a field from the user's document.  This ensures atomic operations and simplifies debugging.\n\nThe structure supports the required QAPs by using structural segregation and path-based ownership.  For instance, listing game offers is done directly from the `gameOffers` collection, which has a uniform security posture. Access to `userGameOffers` is controlled by the `userId` in the path, ensuring that only the user can access their own game offers."
  }
}

    