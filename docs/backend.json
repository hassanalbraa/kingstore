
{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user within the KING STORE application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "username": {
          "type": "string",
          "description": "The user's username."
        },
        "balance": {
          "type": "number",
          "description": "The user's current balance."
        },
        "isAdmin": {
          "type": "boolean",
          "description": "Indicates whether the user has administrator privileges."
        }
      },
      "required": [
        "id",
        "username",
        "balance",
        "isAdmin"
      ]
    },
    "GameOffer": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "GameOffer",
      "type": "object",
      "description": "Represents a game offer available to users.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the GameOffer entity."
        },
        "gameName": {
          "type": "string",
          "description": "The name of the game (e.g., PUBG, Free Fire)."
        },
        "offerName": {
          "type": "string",
          "description": "The name of the specific offer (e.g., 60 Ø´Ø¯Ø©, Ø¹Ø¶ÙˆÙŠØ© Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©)."
        },
        "price": {
          "type": "number",
          "description": "The price of the game offer."
        },
        "unit": {
          "type": "string",
          "description": "The unit of the offer (e.g., Ø´Ø¯Ø©, ðŸ’Ž, ðŸª™)."
        }
      },
      "required": [
        "id",
        "gameName",
        "offerName",
        "price"
      ]
    },
    "UserGameOffer": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserGameOffer",
      "type": "object",
      "description": "Represents a user's purchase of a game offer.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the UserGameOffer entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User."
        },
        "username": {
          "type": "string"
        },
        "walletId": {
          "type": "string"
        },
        "gameOfferId": {
          "type": "string",
          "description": "Reference to GameOffer."
        },
        "gameName": {
          "type": "string"
        },
        "offerName": {
          "type": "string"
        },
        "price": {
          "type": "number"
        },
        "status": {
          "type": "string",
          "enum": ["pending", "completed", "failed"]
        },
        "createdAt": {
            "type": "string",
            "format": "date-time"
        },
        "gameId": {
            "type": "string",
            "description": "The player's in-game ID, required for certain games."
        },
        "gameUsername": {
            "type": "string",
            "description": "The player's in-game username, for verification."
        }
      },
      "required": [
        "id",
        "userId",
        "username",
        "walletId",
        "gameOfferId",
        "gameName",
        "offerName",
        "price",
        "status",
        "createdAt"
      ]
    },
    "Transaction": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Transaction",
      "type": "object",
      "description": "Represents a financial transaction for a user, either a purchase or a top-up.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Transaction."
        },
        "userId": {
          "type": "string",
          "description": "The ID of the user this transaction belongs to."
        },
        "type": {
          "type": "string",
          "enum": ["purchase", "top-up"],
          "description": "The type of transaction."
        },
        "amount": {
          "type": "number",
          "description": "The value of the transaction. Can be negative for purchases."
        },
        "description": {
          "type": "string",
          "description": "A description of the transaction (e.g., 'Purchase: 60 Ø´Ø¯Ø©' or 'Admin top-up')."
        },
        "createdAt": {
          "type": "string",
          "format": "date-time",
          "description": "The timestamp of when the transaction occurred."
        }
      },
      "required": [
        "id",
        "userId",
        "type",
        "amount",
        "description",
        "createdAt"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles. The 'userId' parameter is the unique identifier for each user.",
          "collections": [
            {
              "path": "userGameOffers/{userGameOfferId}",
              "definition": {
                "entityName": "UserGameOffer",
                "schema": {
                  "$ref": "#/backend/entities/UserGameOffer"
                },
                "description": "A sub-collection storing the game offers purchased by this specific user."
              }
            },
            {
              "path": "transactions/{transactionId}",
              "definition": {
                "entityName": "Transaction",
                "schema": {
                  "$ref": "#/backend/entities/Transaction"
                },
                "description": "A sub-collection storing all financial transactions for this user."
              }
            }
          ]
        }
      },
      {
        "path": "gameOffers/{gameOfferId}",
        "definition": {
          "entityName": "GameOffer",
          "schema": {
            "$ref": "#/backend/entities/GameOffer"
          },
          "description": "Stores information about available game offers.  The 'gameOfferId' parameter is the unique identifier for each game offer."
        }
      },
      {
        "path": "roles_admin/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Collection to store user IDs with admin roles. Existence of document implies user has admin privileges."
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support the KING STORE application's features, focusing on user authentication, game offer management, and admin functionalities. The structure prioritizes authorization independence, clarity, and scalability. It avoids hierarchical authorization dependencies by denormalizing necessary authorization data. Structural segregation ensures that collections have a homogeneous security posture, simplifying security rules.  \n\nThe `users` collection stores user profiles.  Admin privileges are managed via a separate `roles_admin` collection, ensuring that checking for admin status relies on document existence, and not on mutable data within the user document itself.  This provides a more robust and reliable authorization mechanism. The `gameOffers` collection stores information about available game offers.  The `userGameOffers` collection is a sub-collection under each user, ensuring data ownership is explicit in the path, which dramatically simplifies security rules. The `transactions` collection is also a sub-collection under each user to track all financial movements. Admins can query all orders across all users using a collection group query, which is secured by a separate rule."
  }
}
